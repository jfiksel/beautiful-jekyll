<!DOCTYPE html>
<html lang="en">
  <!-- Beautiful Jekyll | MIT license | Copyright Dean Attali 2016 -->
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Introduction to Conducting Interim Analyses Using Alpha Spending</title>

  <meta name="author" content="Jacob Fiksel" />

  

  <link rel="alternate" type="application/rss+xml" title="Jacob Fiksel - Site & Blog" href="/feed.xml" />

  

  
    
      <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css" />
    
  

  
    
      <link rel="stylesheet" href="/css/bootstrap.min.css" />
    
      <link rel="stylesheet" href="/css/bootstrap-social.css" />
    
      <link rel="stylesheet" href="/css/main.css" />
    
  

  
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
    
  

  

  

  

    <!-- Facebook OpenGraph tags -->
  

  
  <meta property="og:title" content="Introduction to Conducting Interim Analyses Using Alpha Spending" />
  

   
  <meta property="og:description" content="In confirmatory (phase III) clinical trials, the goal is to test whether an experimental treatment is superior to a standard of care or placebo treatment. In designing the trial, health authorities require that type I error is strictly controlled–that is, if the experimental treatment is truly not better than the...">
  


  <meta property="og:type" content="website" />

  
  <meta property="og:url" content="http://localhost:4000/2021-02-03-alpha_spending_explained/" />
  <link rel="canonical" href="http://localhost:4000/2021-02-03-alpha_spending_explained/" />
  

  
  <meta property="og:image" content="http://localhost:4000/img/zoomed_pic.jpg" />
  
  

  <!-- Twitter summary cards -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@jfiksel1" />
  <meta name="twitter:creator" content="@jfiksel1" />

  
  <meta name="twitter:title" content="Introduction to Conducting Interim Analyses Using Alpha Spending" />
  

  
  <meta name="twitter:description" content="In confirmatory (phase III) clinical trials, the goal is to test whether an experimental treatment is superior to a standard of care or placebo treatment. In designing the trial, health authorities require that type I error is strictly controlled–that is, if the experimental treatment is truly not better than the...">
  

  
  <meta name="twitter:image" content="http://localhost:4000/img/zoomed_pic.jpg" />
  

</head>


  <body>

    
  
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
        <a class="navbar-brand" href="http://localhost:4000">Jacob Fiksel</a>
      
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
      
        
          <li>
            
            





<a href="/blog">Blog</a>

          </li>
        
        
        
          <li>
            
            





<a href="/cv">CV</a>

          </li>
        
        
        
          <li>
            
            





<a href="/papers">Papers</a>

          </li>
        
        
        
          <li>
            
            





<a href="/software">Software</a>

          </li>
        
        
      </ul>
    </div>

	
	<div class="avatar-container">
	  <div class="avatar-img-border">
	    <a href="http://localhost:4000 ">
	      <img class="avatar-img" src="/img/zoomed_pic.jpg" />
		</a>
	  </div>
	</div>
	

  </div>
</nav>


    <!-- TODO this file has become a mess, refactor it -->





<header class="header-section ">

<div class="intro-header no-img">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>Introduction to Conducting Interim Analyses Using Alpha Spending</h1>
		  
		  
		  
		  <span class="post-meta">Posted on February 3, 2021</span>
		  
        </div>
      </div>
    </div>
  </div>
</div>
</header>




<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

      <article role="main" class="blog-post">
        <style type="text/css">
code.has-jax {font: inherit; font-size: 100%; background: inherit; border: inherit;}
</style>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'] // removed 'code' entry
    }
});
MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_HTML-full"></script>

<p>In confirmatory (phase III) clinical trials, the goal is to test whether an experimental
treatment is superior to a standard of care or placebo treatment. In designing the trial, health authorities require that type I error is strictly controlled–that is, if the experimental treatment is truly not better than the control treatment, we want to limit the probability
of declaring success to being no more than some value $\alpha$ (typically $\alpha = .05$).</p>

<p>However, phase III trials are usually very large and very expensive, and sponsors
benefit by making the trial as short and as small as possible. One way we could do that
is by performing a statistical test to see if the treatment is effective halfway through the trial. This is called an interim analysis. If we see a statistically significant treatment effect, we stop the trial very early and save money by not having to enroll
the remaining patients, and we get the drug out to patients faster. If not, we
will just wait until all of the patients have enrolled, like we would have without
this interim analysis.</p>

<p>How exactly would we perform this interim analysis? Well, health authorities want
to have strict control of type I error–this corresponds to declaring success
if our p-value is less than .05 at the end of the trial. So what our type I error be if we decided to declare success if our p-value at the interim analysis was also less than .05? Let’s find out through simulation.</p>

<p>We will assume that we have a binary endpoint and that our original plan was to enroll
500 patients, randomized 1:1 to the treatment and control arm. Let’s assume that patients
taking the drug used for the control arm have a 20% chance of responding to the treatment.
To find the type I error of our design, we will simulate data by assuming that
patients taking the treatment drug also have a 20% chance of responding to the treatment. We
will perform an interim analysis after we have enrolled 250 patients, and if we do not
declare success, we will perform a final analysis after we have enrolled all 500
patients. In our simulation, we will use z-scores to declare success: a p-value of
less than .05 is equivalent to obtaining a z-score $z$ such that $|z| &gt; 1.96$</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1">### Function to get zscore
</span><span class="n">get_z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span><span class="w"> </span><span class="n">trt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">p</span><span class="m">0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">resp</span><span class="p">[</span><span class="n">trt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">])</span><span class="w">
    </span><span class="n">p</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">resp</span><span class="p">[</span><span class="n">trt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">])</span><span class="w">
    </span><span class="n">n</span><span class="m">0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">trt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
    </span><span class="n">n</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">trt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
    </span><span class="n">sd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">p</span><span class="m">1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">n</span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="m">0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">n</span><span class="m">0</span><span class="p">)</span><span class="w">
    </span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sd</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
    
</span><span class="c1">### Set our seed
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">
</span><span class="c1">### Number of simulations
</span><span class="n">Nsims</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10000</span><span class="w">
</span><span class="c1">### keep track of of zscores for interim and final analysis
</span><span class="n">z_scores</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nsims</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="c1">### Numebr of subjects at final and interim analysis
</span><span class="n">Ntotal</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">500</span><span class="w">
</span><span class="n">Ninterim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Ntotal</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">Nsims</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c1">### treatment indicator
</span><span class="w">    </span><span class="n">trt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">Ntotal</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
    </span><span class="c1">### Response probabilities for control and treatment
</span><span class="w">    </span><span class="c1">### They are the same because this is simulating under the null
</span><span class="w">    </span><span class="n">resp_prob</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">Ntotal</span><span class="p">)</span><span class="w">
    </span><span class="n">resp_prob</span><span class="p">[</span><span class="n">trt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">.2</span><span class="w">
    </span><span class="n">resp_prob</span><span class="p">[</span><span class="n">trt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">.2</span><span class="w">
    </span><span class="c1">### Actual response
</span><span class="w">    </span><span class="n">resp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbinom</span><span class="p">(</span><span class="n">Ntotal</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">resp_prob</span><span class="p">)</span><span class="w">
    </span><span class="c1">### z score for interim
</span><span class="w">    </span><span class="n">z_interim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_z</span><span class="p">(</span><span class="n">resp</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="n">Ninterim</span><span class="p">],</span><span class="w"> </span><span class="n">trt</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="n">Ninterim</span><span class="p">])</span><span class="w">
    </span><span class="c1">### z score for final
</span><span class="w">    </span><span class="n">z_final</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_z</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span><span class="w"> </span><span class="n">trt</span><span class="p">)</span><span class="w">
    </span><span class="c1">### Do we reject at either the interim or final analysis
</span><span class="w">    </span><span class="n">z_scores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">z_interim</span><span class="w">
    </span><span class="n">z_scores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">z_final</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1">### Type 1 error
### Get cutoff for rejection (this is approximately 1.96)
</span><span class="n">cutoff</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">.975</span><span class="p">)</span><span class="w">
</span><span class="c1">### Check for each simulation whether we rejected at either interim or final analysis
</span><span class="n">reject</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">Nsims</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">Nsims</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">reject</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">abs</span><span class="p">(</span><span class="n">z_scores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">1</span><span class="p">])</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">cutoff</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">abs</span><span class="p">(</span><span class="n">z_scores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">2</span><span class="p">])</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">cutoff</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">type_1_error</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">reject</span><span class="p">)</span><span class="w">
</span><span class="n">type_1_error</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 0.0872
</code></pre>
</div>

<p>We see from above that our type I error is actually 0.087–
more than the .05 level that health authorities are willing to accept! Our
naive strategy clearly led to an inflated type I error, and if we had decided
to do more than 1 interim analysis, the type I error would have been even higher. Thus,
we need a more principled strategy.</p>

<p>This is where the idea of alpha spending comes in. Under the null hypothesis
of no treatment effect, we want the probability of rejecting our null hypothesis
at ANY of the interim analyses to be .05. Formally, if we performed an interim and
a final analysis, and got z-scores $z_{1}$ and $z_{2}$, we would reject our null hypothesis at the first interim analysis of $|z_{1}| &gt; c_{1}$ (for some cutoff $c_{1}$), and similarly we would reject our null hypothesis at the final analysis if $|z_{2}| &gt; c_{2}$ (and $|z_{1}| \leq c_{1}$, which we would need in order to even be performing a final analysis). Thus, we want
$P(|z_{1}| &gt; c_{1} \mbox{ OR } |z_{1}| \leq c_{1} \mbox{ &amp; } |z_{2}| &gt; c_{2}) = .05$.</p>

<p>So how exactly do we determine these cutoffs? Other than the constraint of the
type-I error above, we actually have quite a lot of latitude. In the single interim
analysis example, we first have to decide on our type I error for the first interim analysis–that is, under the null, the probability of seeing $|z_{1}| &gt; c_{1}$. We could pick .025, in which case we have $c_{1} = 2.24$. Or we might say that we only want to stop
at the interim analysis if we see a very strong effect, and pick .01, in which case $c_{1} = 2.58$. But let’s stick with .025. How do we then determine $c_{2}$? One might think
that the cutoff $c_{2}$ would also be 2.24, corresponding to a p-value of  .05 - .025 = .025. That is, if we don’t declare success at the first interim, we’ve “spent” our first interim analysis alpha of .025, and thus have .025 left over. However, let’s look at a plot
of the z-score from the first interim analysis versus the final analysis from the earlier simulation:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">z_scores</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">z_scores</span><span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Z-score IA"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Z-score FA"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/img/blog_images/alpha_spending_explained_files/figure-html/plot_zscores-1.png" alt="" /></p>

<p>We see that they’re actually correlated! This is unsurprising, because all of the patients used to calculate the z-score for the first interim analysis are also used the calculate the z-score in the final analysis. What exactly is the correlation?</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">z_score_cor</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cor</span><span class="p">(</span><span class="n">z_scores</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">z_scores</span><span class="p">[,</span><span class="m">2</span><span class="p">])</span><span class="w">
</span><span class="nf">round</span><span class="p">(</span><span class="n">z_score_cor</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 0.711
</code></pre>
</div>

<p>Interestingly, this is very close to $\sqrt{.5}$–and in fact, the theoretical
correlation between these two z-scores is exactly $\sqrt{.5}$. Why exactly this value? Because we did the interim analysis exactly halfway through our trial. If we had done the interim analysis 20% of the way through the trial, the correlation would have been $\sqrt{.2}$. And if we did two interim analyses–one at 20%, and one at 50%–then the correlation between the z-scores for these two interim analyses would have been $\sqrt{.2 / .5}$. Thus, we have
to take this correlation into account when we calculate $c_{2}$. However, this
involves quite a bit of calculus. Luckily, we have the R package <code class="highlighter-rouge">rpact</code> that can calculate this cutoff for us:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">rpact</span><span class="p">)</span><span class="w">
</span><span class="n">design</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">getDesignGroupSequential</span><span class="p">(</span><span class="n">sided</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w">
</span><span class="n">informationRates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">typeOfDesign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"asUser"</span><span class="p">,</span><span class="w"> </span><span class="n">userAlphaSpending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">.025</span><span class="p">,</span><span class="w"> </span><span class="m">.05</span><span class="p">))</span><span class="w">
</span><span class="c1">### Boundaries (c1 and c2) for design
</span><span class="n">design</span><span class="o">$</span><span class="n">criticalValues</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 2.241403 2.125119
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1">### pvalues for design
</span><span class="n">design</span><span class="o">$</span><span class="n">stageLevels</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 0.0250000 0.0335767
</code></pre>
</div>

<p>We actually see that we can reject the null hypothesis at the final analysis if we obtain a p-value of less than .034, rather than using a value of .025. We can now recalculate our type I error from the previous simulation with these new boundaries:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1">### Check for each simulation whether we rejected at either interim or final analysis
</span><span class="n">reject</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">Nsims</span><span class="p">)</span><span class="w">
</span><span class="n">cutoffs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">design</span><span class="o">$</span><span class="n">criticalValues</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">Nsims</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">reject</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">abs</span><span class="p">(</span><span class="n">z_scores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">1</span><span class="p">])</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">cutoffs</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">abs</span><span class="p">(</span><span class="n">z_scores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">2</span><span class="p">])</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">cutoffs</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">type_1_error</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">reject</span><span class="p">)</span><span class="w">
</span><span class="n">type_1_error</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 0.0523
</code></pre>
</div>

<p>Our type I error rate for this trial design is now closer to .05, although not exactly .05 due to simulation error.</p>

<p>Lan and DeMets (Statistics in Medicine, 1994) generalized this approach in what they call alpha spending. One can conduct any number of interim analyses throughout the trial, as long as they specify what is called an alpha spending function. This alpha spending function, denoted $\alpha(t)$, is a non-decreasing function of the information fraction $t$–that is, the fraction of the total sample size (or total number of events for event driven trials). $\alpha(1)$ must be the type I error of the whole trial. In our example, we had $\alpha(.5) = .025$ and $\alpha(1) = .05$. If we plan on doing $K$ total analyses ($K-1$ interim analyses, and 1 final analysis), and information fractions $t_1, t_2, \ldots, t_K = 1$,  then the probability of rejecting the null hypothesis (if the null hypothesis is true) at the first interim analysis is $\alpha(t_1)$. The probability under the null of not rejecting at the first interim, but at the second interim, is $\alpha(t_2) - \alpha(t_1)$, and so the probability of rejecting at either first or second interim is $\alpha(t_2)$. We can continue this logic until we reach $\alpha(t_K)$, which is our type-I error of rejecting the null hypothesis (when the null is true) at any point in the trial. If we pre-specify our information fractions and our alpha spending function, we can use the <code class="highlighter-rouge">rpact</code> package to get our cutoffs used for each analysis, $c_1, \ldots, c_K$.</p>

<p>There are infinitely many alpha spending functions we could use. However, the two
most commonly used spending functions are the O’Brien-Fleming (OBF) and Pocock spending functions.
We can illustrate the difference between the two by plotting the stopping boundaries for
a trial with interim analyses at 20%, 40%, 60%, 80%, and 100% information fractions:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">design_obf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">getDesignGroupSequential</span><span class="p">(</span><span class="n">sided</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w">
</span><span class="n">informationRates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">.2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.2</span><span class="p">),</span><span class="w"> </span><span class="n">typeOfDesign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"asOF"</span><span class="p">)</span><span class="w">
</span><span class="n">design_pocock</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">getDesignGroupSequential</span><span class="p">(</span><span class="n">sided</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w">
</span><span class="n">informationRates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">.2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.2</span><span class="p">),</span><span class="w"> </span><span class="n">typeOfDesign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"asP"</span><span class="p">)</span><span class="w">
</span><span class="n">boundary_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">critical_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">design_obf</span><span class="o">$</span><span class="n">criticalValues</span><span class="p">,</span><span class="w"> </span><span class="n">design_pocock</span><span class="o">$</span><span class="n">criticalValues</span><span class="p">),</span><span class="w">
                          </span><span class="n">spending_function</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s1">'OBF'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Pocock'</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">),</span><span class="w">
                          </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="m">.2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.2</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">boundary_df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">critical_values</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spending_function</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Information Fraction"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Critical Value"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Spending Function"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/img/blog_images/alpha_spending_explained_files/figure-html/obf_vs_pocock-1.png" alt="" /></p>

<p>We can see a big difference between these two spending functions. The OBF spending
function requires a large z-score to declare significance early on in the trial,
and these boundaries decrease as the information fraction increases, with the final
cutoff $c_K$ being very close to the level of 1.96 we started with if we did not
perform interim analyses. The Pocock spending function corresponds to using
approximately equal cutoffs for each analysis. The OBF spending function is more commonly
used (at least in my experience), because 1) we want to only stop early with a smaller sample size if we have an extremely convincing effect size estimate and 2) If we were to not
succeed in the interim analyses, we have a smaller hurdle for the final analysis.</p>

<p>The idea of an alpha spending function is incredibly important for clinical trials. 
All of the major phase III trials for coronavirus vaccines used alpha spending so that
they could conduct multiple interim analyses without inflating the type I error. Thus, I hope that this gave a (slightly technical) introduction and intuition on how we can do principled interim analyses using alpha spending.</p>

      </article>

      
        <div class="blog-tags">
          Tags:
          
            Clinical Trials, Alpha Spending, Group Sequential, R
          
        </div>
      

      
        <!-- Check if any share-links are active -->




<section id = "social-share-section">

  <!--- Share on Twitter -->
  
    <a href="https://twitter.com/intent/tweet?text=Introduction+to+Conducting+Interim+Analyses+Using+Alpha+Spending+http://localhost:4000/2021-02-03-alpha_spending_explained/"
      class="btn btn-social-icon btn-twitter" title="Share on Twitter">
      <span class="fa fa-fw fa-twitter" aria-hidden="true"></span>
    </a>
  

  <!--- Share on Facebook -->
  

  <!--- Share on Google Plus -->
  

  <!--- Share on LinkedIn -->
  

</section>



      

      <ul class="pager blog-pager">
        
        <li class="previous">
          <a href="/2018-01-15-visualizing-genomic-deletions/" data-toggle="tooltip" data-placement="top" title="Visualizing genomic deletions in R">&larr; Previous Post</a>
        </li>
        
        
      </ul>

      
        <div class="disqus-comments">
          
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">
	    var disqus_shortname = 'jfiksel-site';
	    /* ensure that pages with query string get the same discussion */
            var url_parts = window.location.href.split("?");
            var disqus_url = url_parts[0];	    
	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();
	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>


        </div>
      
    </div>
  </div>
</div>

    <footer>
  <div class="container beautiful-jekyll-footer">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
          <li>
            <a href="https://github.com/jfiksel" title="GitHub">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		  
          <li>
            <a href="https://twitter.com/jfiksel1" title="Twitter">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
	  
      
		  
          <li>
            <a href="mailto:jfiksel@gmail.com" title="Email me">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		  
		  
		  
      
      
      
      
      
		  
        </ul>
        <p class="copyright text-muted">
		  Jacob Fiksel
		  &nbsp;&bull;&nbsp;
		  2021

		  
	    </p>
	        <!-- Please don't remove this, keep my open source work credited :) -->
		<p class="theme-by text-muted">
		  Theme by
		  <a href="http://deanattali.com/beautiful-jekyll/">beautiful-jekyll</a>
		</p>
      </div>
    </div>
  </div>
</footer>

  
    






  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script>
      	if (typeof jQuery == 'undefined') {
      	  document.write('<script src="/js/jquery-1.11.2.min.js"></scr' + 'ipt>');
      	}
      </script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
	<script src="/js/bootstrap.min.js"></script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
	<script src="/js/main.js"></script>
    
  




  
  </body>
</html>
